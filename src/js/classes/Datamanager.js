import{Trackeraccount as t}from"../Aggregator.js";import{Month as a}from"../Aggregator.js";export class Datamanager{constructor(){this.dataAsString=localStorage.getItem("kamedin-moneytracker"),this.languageData=this.loadLanguage(),this.mydata=Object.assign({},this.loadData()),this.singleTrans={type:null,date:null,category:null,amount:null},this.multiTrans={type:null,due:null,category:null,amount:null,amountPerMonth:null}}delete_transaction(t,a){let e,n="",s=this.mydata.trackeraccounts[this.monthArrayOfWho()].months[this.get_indexOfMonthId(a)];for(let r=0;r<s.expenses.length;r++)if(s.expenses[r].identifier===t){e=r,n="expenses";break}if(void 0===e){n="earnings";for(let i=0;i<s.earnings.length;i++)if(s.earnings[i].identifier===t){e=i;break}}s[n].splice(e,1),this.saveData()}get_dashboardData(t,a,e,n,s,r){let i=0;for(let h=0;h<t.mydata.trackeraccounts[e].months.length;h++)if(a===t.mydata.trackeraccounts[e].months[h].month_id){i=h;break}let o=0;t.mydata.trackeraccounts[e].months[i].earnings.forEach(t=>{o+=t.amount});let c=0;t.mydata.trackeraccounts[e].months[i].expenses.forEach(t=>{c+=t.amount});let m=0,l=0;t.mydata.trackeraccounts[e].runningTransactions.forEach(t=>{"expense"===t.type?m+=t.amountPerMonth:l+=t.amountPerMonth});let u=o-c+(l-m),d=n-s+1,g=0,y=0;return u<0?(g=0,y=0):(g=u/d,y=u/Math.ceil(d/7)),{balance:u,earningsTotal:o,fixedExpenses:m,fixedEarnings:l,expensesTotal:c,weeklyBudget:y,daylyBudget:g}}compute_monthlyAmount(){let t=0;switch(this.multiTrans.due){case"month":this.set_multiTrans("amountPerMonth",this.multiTrans.amount);break;case"week":t=52*this.multiTrans.amount,this.set_multiTrans("amountPerMonth",t/12);break;case"quarter":t=4*this.multiTrans.amount,this.set_multiTrans("amountPerMonth",t/12);break;case"halfyear":t=2*this.multiTrans.amount,this.set_multiTrans("amountPerMonth",t/12);break;case"year":t=this.multiTrans.amount,this.set_multiTrans("amountPerMonth",t/12)}}add_multiTransaction(t,a){let e;this.monthId_existent(a)||this.createNewMonth(a),e=this.get_indexOfMonthId(a),this.mydata.trackeraccounts[this.monthArrayOfWho()].runningTransactions.push(t),this.saveData()}set_multiTrans(t,a){this.multiTrans[t]=a}get_monthEntriesFromId(t){let a=0,e=this.mydata.trackeraccounts[this.monthArrayOfWho()].months;for(let n=0;n<e.length;n++)if(e[n].month_id===t){a=n;break}let s=0;return s+=this.mydata.trackeraccounts[this.monthArrayOfWho()].months[a].expenses.length,s+=this.mydata.trackeraccounts[this.monthArrayOfWho()].months[a].earnings.length,s+=this.mydata.trackeraccounts[this.monthArrayOfWho()].runningTransactions.length}delete_trackerAccount(t){for(let a=0;a<this.mydata.trackeraccounts.length;a++)if(t===this.mydata.trackeraccounts[a].name){this.mydata.trackeraccounts.splice(a,1);break}this.mydata.activeTrackeraccount=this.mydata.trackeraccounts[0].name,this.saveData()}set_newActiveAccount(t){this.mydata.activeTrackeraccount=t}add_category(t){this.mydata.trackeraccounts[this.monthArrayOfWho()].categories.push(t),this.saveData()}delete_category(t){let a=this.mydata.trackeraccounts[this.monthArrayOfWho()].categories.indexOf(t);this.mydata.trackeraccounts[this.monthArrayOfWho()].categories.splice(a,1),this.saveData()}add_singleTransaction(t,a){let e;this.monthId_existent(a)||this.createNewMonth(a),e=this.get_indexOfMonthId(a),this.mydata.trackeraccounts[this.monthArrayOfWho()].months[e][t.type+"s"].push(t),this.saveData()}get_indexOfMonthId(t){let a=this.monthArrayOfWho(),e=0;for(let n=0;n<this.mydata.trackeraccounts[a].months.length;n++)if(this.mydata.trackeraccounts[a].months[n].month_id===t){e=n;break}return e}validate_transactions(t){let a=0;switch(t){case"single":for(let e in this.singleTrans)null===this.singleTrans[e]&&a++;break;case"repeating":for(let n in this.multiTrans)null===this.multiTrans[n]&&a++}return 0===a}reset_multiTrans(){for(let t in this.multiTrans)this.multiTrans[t]=null}reset_singleTrans(){for(let t in this.singleTrans)this.singleTrans[t]=null}set_singleTrans(t,a){this.singleTrans[t]=a}createNewMonth(t){let e=this.monthArrayOfWho(),n=new a(t);this.mydata.trackeraccounts[e].months.push(n)}monthId_existent(t){let a=this.monthArrayOfWho();if(0===this.mydata.trackeraccounts[a].months.length)return!1;{let e=0;for(let n=0;n<this.mydata.trackeraccounts[a].months.length;n++)this.mydata.trackeraccounts[a].months[n].month_id===t&&e++;return 0!==e}}monthArrayOfWho(){let t=this.mydata.activeTrackeraccount;for(let a=0;a<this.mydata.trackeraccounts.length;a++)if(this.mydata.trackeraccounts[a].name===t)return a}isDataExistent(){return!!this.dataAsString}createTrackeraccount(a,e,n){this.dataAsString?this.dataAsString&&(this.mydata.trackeraccounts.push(new t(a,e,n)),this.saveData()):(this.createFirstData(a),this.createTrackeraccount(a,e,n))}createFirstData(t){let a=localStorage.getItem("kamedin-moneytracker-language");this.mydata.language=a,this.mydata.trackeraccounts=[],this.mydata.activeTrackeraccount=t,this.saveData()}saveData(){localStorage.setItem("kamedin-moneytracker",JSON.stringify(this.mydata)),this.dataAsString=localStorage.getItem("kamedin-moneytracker")}loadLanguage(){let t;return localStorage.getItem("kamedin-moneytracker-language")}loadData(){let t,a=localStorage.getItem("kamedin-moneytracker");return a?JSON.parse(a):{}}}